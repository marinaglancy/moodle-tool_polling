define ("tool_polling/poll",["core/pubsub"],function(a){var b,c=[],d,e=function(){var a=new Date,b=a.getTime();c.push(b);c=c.slice(-10);return!(10<=c.length&&5e3>b-c[0])},f=function(a){var b=[],c,d;for(c in a){var e=!1;if(a[c].groupevents){for(d in b){if(b[d].event===a[c].event&&b[d].groupevents){b[d].event.id=a[c].id;e=!0;break}}}if(!e){b.push(a[c])}}return b},g=function(){if(!e()){return}var c=new XMLHttpRequest,h;c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(200===this.status){try{h=JSON.parse(this.responseText)}catch(a){g();return}if(!h.success||1!==h.success){return}var c=f(h.results);for(var d in c){a.publish(c[d].event,c[d].addinfo);b.fromid=c[d].id}g()}else{g()}}};var i=d+"?userid="+encodeURIComponent(b.userid)+"&token="+encodeURIComponent(b.token)+"&fromid="+encodeURIComponent(b.fromid);c.open("GET",i,!0);c.send()};return{init:function init(a,c,e,f){if(b&&b.userid){return}b={userid:a,token:c,fromid:e};d=f;g()}}});
//# sourceMappingURL=poll.min.js.map
